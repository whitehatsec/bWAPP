# PHP
# Test and package your PHP project.
# Add steps that run tests, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/php

trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- task: Docker@2
  inputs:
    command: 'build'
    Dockerfile: '**/Dockerfile'
    arguments: '-t bwapp'
  displayName: 'build docker image'

- script: |
    docker run -d -p 3005:80 bwapp
  displayName: 'start bwapp'

- task: Delay@1
  inputs:
    delayForMinutes: '.10'

- script: |
    wget http://localhost:3005/install.php?install=yes
  displayName: 'init bwapp'


#- script: |
#    wget https://github.com/whitehatsec/vantage-prevent-distributions/releases/latest/download/VantagePrevent.deb          
#    sudo apt-get install -f ./VantagePrevent.deb
#    sudo dast-attacker-cli -init -license-key=11dbc457-356c-4fde-a377-f7408300abce  
#    sudo dast-attacker-cli -output-json=results.json -output-html=results.html .scan/*.har
#  displayName: 'Install Prevent'

#- script: composer install --no-interaction --prefer-dist
#  displayName: 'composer install'
